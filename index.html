<script type="module">
  // Importar las funciones necesarias desde los SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
  
  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDn4smuABKPgN8DBYI2LAzoKhe3EbEYTQk",
    authDomain: "sala-cultivo.firebaseapp.com",
    databaseURL: "https://sala-cultivo-default-rtdb.firebaseio.com",
    projectId: "sala-cultivo",
    storageBucket: "sala-cultivo.firebasestorage.app",
    messagingSenderId: "388469961230",
    appId: "1:388469961230:web:d16beb9ef00ddf0866c25f",
    measurementId: "G-72JQD67R0X"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Función para actualizar Firebase
  function updateFirebase(path, value) {
    const dbRef = ref(db, path);
    set(dbRef, value);
  }

  // Funciones para escuchar cambios desde Firebase
  function listenFirebase(path, callback) {
    const dbRef = ref(db, path);
    onValue(dbRef, (snapshot) => {
      const data = snapshot.val();
      callback(data);
    });
  }

  // Código para actualizar datos de control
  document.getElementById('dpv-min').addEventListener('input', (e) => {
    updateFirebase('config/dpv-min', e.target.value);
  });

  document.getElementById('dpv-max').addEventListener('input', (e) => {
    updateFirebase('config/dpv-max', e.target.value);
  });

  // Escuchar cambios en tiempo real desde Firebase y actualizar UI
  listenFirebase('sensores/humedad_ambiente', (data) => {
    document.getElementById('humidity--span').textContent = data;
  });

  listenFirebase('sensores/deficit_presion_vapor', (data) => {
    document.getElementById('dpv--span').textContent = data;
  });

  listenFirebase('sensores/humedad_suelo', (data) => {
    document.getElementById('soil-moisture--span').textContent = data;
  });

  listenFirebase('estado_actual/luces', (data) => {
    document.getElementById('lights-status').textContent = data ? "Prendidas" : "Apagadas";
  });

  listenFirebase('estado_actual/humidificador', (data) => {
    document.getElementById('humidifier-status').textContent = data ? "Prendido" : "Apagado";
  });

  listenFirebase('estado_actual/extractor', (data) => {
    document.getElementById('extractor-status').textContent = data ? "Prendido" : "Apagado";
  });

  listenFirebase('estado_actual/bomba_riego', (data) => {
    document.getElementById('watering-status').textContent = data ? "Prendido" : "Apagado";
  });
</script>
